FROM --platform=linux/amd64 ubuntu:22.04

# Update before installing anything
RUN apt-get update

# Install gcc, make, etc
RUN apt-get -y install build-essential cmake

# Install essentials
RUN apt-get -y install git vim wget

# Install developer dependencies
RUN apt-get -y install libssl-dev libcurl4-openssl-dev rapidjson-dev libgtest-dev 

# Install SoftHSM
WORKDIR /workspaces
RUN wget https://dist.opendnssec.org/source/softhsm-2.6.1.tar.gz
RUN wget https://dist.opendnssec.org/source/softhsm-2.6.1.tar.gz.sha256
RUN sha256sum --check softhsm-2.6.1.tar.gz.sha256
RUN tar -xzvf softhsm-2.6.1.tar.gz && rm softhsm-2.6.1.tar.gz
WORKDIR /workspaces/softhsm-2.6.1
RUN ./configure
RUN make
RUN make install
